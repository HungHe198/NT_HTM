@model IEnumerable<NT.SHARED.Models.Order>

@{
    ViewBag.Title = "L·ªãch s·ª≠ b√°n h√†ng t·∫°i qu·∫ßy";
    Layout = "~/Views/Shared/_ClientLayout.cshtml";
    int days = ViewBag.Days ?? 30;
}

<div class="container-fluid py-4">
  <div class="row mb-4">
      <div class="col">
            <h1 class="h3">üìä L·ªãch s·ª≠ b√°n h√†ng t·∫°i qu·∫ßy</h1>
      <p class="text-muted">Th·ªùi gian: T·ª´ @DateTime.UtcNow.Date.AddDays(-days).ToString("dd/MM/yyyy") ƒë·∫øn @DateTime.UtcNow.Date.ToString("dd/MM/yyyy")</p>
        </div>
        <div class="col-auto">
            <a href="@Url.Action("Index", "Sales")" class="btn btn-primary">
                <i class="bi bi-shop"></i> B√°n h√†ng m·ªõi
     </a>
    </div>
    </div>

    <!-- Stats Cards -->
    <div class="row g-3 mb-4">
      <div class="col-md-3">
   <div class="card shadow-sm">
        <div class="card-body">
       <h6 class="text-muted mb-1">T·ªïng ƒë∆°n h√†ng</h6>
       <p class="h3 mb-0">@(Model?.Count() ?? 0)</p>
           </div>
       </div>
        </div>
        <div class="col-md-3">
            <div class="card shadow-sm">
         <div class="card-body">
         <h6 class="text-muted mb-1">T·ªïng doanh thu</h6>
           <p class="h3 mb-0" style="color: #28a745;">@Model?.Sum(o => o.FinalAmount).ToString("#,##0")‚Ç´</p>
      </div>
     </div>
    </div>
        <div class="col-md-3">
          <div class="card shadow-sm">
      <div class="card-body">
          <h6 class="text-muted mb-1">T·ªïng gi·∫£m gi√°</h6>
    <p class="h3 mb-0" style="color: #dc3545;">@Model?.Sum(o => o.DiscountAmount ?? 0).ToString("#,##0")‚Ç´</p>
 </div>
   </div>
  </div>
    <div class="col-md-3">
            <div class="card shadow-sm">
     <div class="card-body">
                    <h6 class="text-muted mb-1">ƒê∆°n trung b√¨nh</h6>
        <p class="h3 mb-0">@(Model?.Any() == true ? (Model.Sum(o => o.FinalAmount) / Model.Count()).ToString("#,##0") : "0")‚Ç´</p>
        </div>
          </div>
   </div>
    </div>

    <!-- Orders Table -->
    <div class="card shadow-sm">
        <div class="card-header bg-light">
       <h5 class="mb-0">Danh s√°ch ƒë∆°n h√†ng</h5>
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
       <table class="table table-hover align-middle mb-0">
            <thead class="table-light">
    <tr>
        <th>M√£ ƒë∆°n</th>
        <th>SƒêT kh√°ch</th>
        <th>T·ªïng ti·ªÅn</th>
         <th>Gi·∫£m gi√°</th>
    <th>Th√†nh ti·ªÅn</th>
<th>PT thanh to√°n</th>
      <th>Tr·∫°ng th√°i</th>
  <th>Ng√†y gi·ªù</th>
           <th>H√†nh ƒë·ªông</th>
  </tr>
           </thead>
     <tbody>
@if (!(Model?.Any() ?? false))
        {
           <tr>
         <td colspan="9" class="text-center py-4 text-muted">
      <i class="bi bi-inbox" style="font-size: 2rem; opacity: 0.3;"></i>
         <p class="mt-2">Ch∆∞a c√≥ ƒë∆°n h√†ng n√†o</p>
   </td>
      </tr>
         }
               else
            {
             @foreach (var order in Model.OrderByDescending(o => o.CreatedTime))
       {
<tr>
  <td>
               <code>@order.Id.ToString().Substring(0, 8).ToUpper()</code>
           </td>
         <td>@order.PhoneNumber</td>
      <td>@order.TotalAmount.ToString("#,##0")‚Ç´</td>
<td>
                @if (order.DiscountAmount.HasValue && order.DiscountAmount > 0)
       {
      <span class="text-danger">-@order.DiscountAmount.Value.ToString("#,##0")‚Ç´</span>
  }
 else
     {
     <span class="text-muted">‚Äî</span>
  }
           </td>
       <td><strong class="text-primary">@order.FinalAmount.ToString("#,##0")‚Ç´</strong></td>
               <td>@(order.PaymentMethod?.Name ?? "N/A")</td>
            <td>
              @{
      string statusBadge = order.Status switch
       {
         "-1" => "badge bg-danger",
              "0" => "badge bg-warning",
       "1" => "badge bg-info",
        "2" => "badge bg-primary",
      "3" => "badge bg-success",
            _ => "badge bg-secondary"
        };
   string statusText = order.Status switch
      {
    "-1" => "ƒê√£ h·ªßy",
          "0" => "Ch·ªù x√°c nh·∫≠n",
         "1" => "ƒê√£ x√°c nh·∫≠n",
     "2" => "ƒêang giao",
     "3" => "Giao th√†nh c√¥ng",
        _ => "Kh√¥ng r√µ"
      };
 }
            <span class="@statusBadge">@statusText</span>
          </td>
       <td><small>@order.CreatedTime.ToString("dd/MM/yyyy HH:mm")</small></td>
                  <td>
      <div class="btn-group btn-group-sm">
    <a href="@Url.Action("Review", "Orders", new { id = order.Id })" class="btn btn-outline-primary" title="Xem chi ti·∫øt">
           <i class="bi bi-eye"></i>
            </a>
                <a href="@Url.Action("PrintReceipt", "Sales", new { orderId = order.Id })" class="btn btn-outline-info" title="In h√≥a ƒë∆°n">
              <i class="bi bi-printer"></i>
    </a>
        </div>
    </td>
       </tr>
 }
        }
          </tbody>
      </table>
            </div>
        </div>
    </div>
</div>

<style>
    .table-hover tbody tr:hover {
        background-color: #f8f9fa;
    }
</style>
