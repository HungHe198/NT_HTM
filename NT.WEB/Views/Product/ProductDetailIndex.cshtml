@{
    Layout = "~/Views/Shared/_ClientLayout.cshtml";
    var product = ViewBag.Product as NT.SHARED.Models.Product;
    var details = ViewBag.Details as IEnumerable<NT.SHARED.Models.ProductDetail> ?? Enumerable.Empty<NT.SHARED.Models.ProductDetail>();
    var detailImages = ViewBag.DetailImages as Dictionary<Guid, List<string>> ?? new Dictionary<Guid, List<string>>();
    var hardnessOptions = ViewBag.HardnessOptions as IEnumerable<NT.SHARED.Models.Hardness> ?? Enumerable.Empty<NT.SHARED.Models.Hardness>();
    var lengthOptions = ViewBag.LengthOptions as IEnumerable<NT.SHARED.Models.Length> ?? Enumerable.Empty<NT.SHARED.Models.Length>();
    
    var allVariantImages = new List<(Guid detailId, string imageUrl)>();
    foreach (var d in details)
    {
        if (detailImages.TryGetValue(d.Id, out var imgs))
        {
   foreach (var img in imgs)
 {
                allVariantImages.Add((d.Id, img));
            }
  }
    }
}

<div class="container py-5">
    <!-- PRODUCT MAIN SECTION -->
  <div class="row g-4 mb-5">
        <!-- LEFT: IMAGES & GALLERY -->
   <div class="col-lg-5">
 <div class="card shadow-sm position-sticky" style="top: 20px;">
 <div class="card-body">
    <!-- Main Product Image -->
          <div class="ratio ratio-1x1 mb-3 bg-light rounded overflow-hidden border">
     <img id="main-product-image" 
       src="@((product?.Thumbnail) ?? "/images/product-placeholder.png")" 
alt="@product?.Name" 
class="img-fluid" 
  style="object-fit: contain; cursor: zoom-in;"
   onclick="openLightbox(this.src)" />
        </div>

       <!-- Thumbnail Gallery -->
            <div class="thumbnail-gallery d-flex flex-nowrap gap-2 overflow-auto">
     @if (!string.IsNullOrWhiteSpace(product?.Thumbnail))
  {
          <img src="@product.Thumbnail" 
        alt="Ảnh chính" 
   class="thumbnail-img active flex-shrink-0" 
     data-detail-id="" 
             data-image-url="@product.Thumbnail"
     style="width: 70px; height: 70px; object-fit: cover; cursor: pointer; border: 3px solid #007bff; border-radius: 8px;" 
          onclick="selectThumbnail(this)" />
   }
@foreach (var item in allVariantImages.Take(8))
             {
         <img src="@item.imageUrl" 
        alt="Ảnh biến thể" 
 class="thumbnail-img flex-shrink-0" 
        data-detail-id="@item.detailId" 
         data-image-url="@item.imageUrl"
            style="width: 70px; height: 70px; object-fit: cover; cursor: pointer; border: 3px solid #e9ecef; border-radius: 8px; transition: border-color 0.2s;" 
   onclick="selectThumbnail(this)" />
    }
        </div>
        </div>
  </div>
        </div>

  <!-- RIGHT: PRODUCT INFO & SELECTION -->
  <div class="col-lg-7">
         <!-- Header Info -->
      <div class="mb-4">
         <div class="d-flex align-items-start justify-content-between mb-3">
    <div>
  <h1 class="h2 mb-2">@product?.Name</h1>
       <p class="text-muted mb-0">
   <strong>Mã:</strong> <code>@product?.ProductCode</code>
       </p>
     </div>
   @if (product?.Brand != null)
          {
             <span class="badge bg-secondary py-2 px-3">@product.Brand.Name</span>
    }
              </div>

        @if (!string.IsNullOrWhiteSpace(product?.ShortDescription))
    {
           <p class="lead text-muted">@product.ShortDescription</p>
        }

    <!-- Price Range -->
  @if (details.Any())
                {
 var minPrice = details.Min(d => d.Price);
        var maxPrice = details.Max(d => d.Price);
                    <div class="mb-4">
          <span class="fs-4 text-danger fw-bold">@minPrice.ToString("#,##0")₫</span>
       @if (minPrice != maxPrice)
          {
 <span class="fs-5 text-muted"> – @maxPrice.ToString("#,##0")₫</span>
          }
            </div>
         }
            </div>

  <!-- Variant Selection Card -->
    <div class="card shadow-sm mb-4 border-0">
 <div class="card-body">
           <h5 class="card-title mb-3">Chọn thông số</h5>

           <!-- Hardness Options -->
            <div class="mb-4">
    <label class="form-label fw-bold mb-2">Độ cứng</label>
  <div id="hardness-options" class="d-flex flex-wrap gap-2">
   @foreach (var h in hardnessOptions)
   {
var countForH = details.Count(d => d.HardnessId == h.Id && d.StockQuantity > 0);
           var disabled = countForH == 0;
        <button type="button"
  class="btn btn-sm btn-outline-primary option-btn hardness-btn fw-500 px-3"
       data-hardness-id="@h.Id"
        disabled="@(disabled ? "disabled" : null)">
          @h.Name
      </button>
           }
       </div>
     </div>

         <!-- Length Options -->
    <div class="mb-4">
                   <label class="form-label fw-bold mb-2">Chiều dài</label>
     <div id="length-options" class="d-flex flex-wrap gap-2">
          @foreach (var l in lengthOptions)
      {
          var countForL = details.Count(d => d.LengthId == l.Id && d.StockQuantity > 0);
      var disabled = countForL == 0;
          <button type="button"
           class="btn btn-sm btn-outline-primary option-btn length-btn fw-500 px-3"
        data-length-id="@l.Id"
          disabled="@(disabled ? "disabled" : null)">
          @l.Name
      </button>
           }
          </div>
                 </div>

          <!-- Quantity -->
         <div class="mb-4">
    <label class="form-label fw-bold mb-2">Số lượng</label>
 <div class="input-group" style="max-width: 150px;">
       <button class="btn btn-outline-secondary" type="button" id="qty-minus">−</button>
  <input type="number" class="form-control text-center fw-semibold" id="qty" value="1" min="1" />
      <button class="btn btn-outline-secondary" type="button" id="qty-plus">+</button>
         </div>
           </div>

             <!-- Summary -->
   <div class="alert alert-info py-2 mb-0" id="selection-summary">
            Vui lòng chọn độ cứng và chiều dài
              </div>
        </div>
            </div>

            <!-- Action Buttons -->
<div class="d-grid gap-2 gap-sm-0 d-sm-flex gap-sm-2 mb-4">
<button id="add-to-cart" class="btn btn-outline-warning btn-lg fw-bold">
    <i class="bi bi-cart-plus"></i> Thêm vào giỏ
      </button>
                <button id="buy-now" class="btn btn-danger btn-lg fw-bold">
         <i class="bi bi-lightning"></i> Mua ngay
                </button>
            </div>

            <!-- Additional Info -->
   <div class="row g-2 small">
      @if (!string.IsNullOrWhiteSpace(product?.Status))
   {
      <div class="col-12">
         <strong>Trạng thái:</strong>
            <span class="badge bg-success">@product.Status</span>
            </div>
           }
</div>
  </div>
 </div>

    <!-- DESCRIPTION SECTION -->
    @if (!string.IsNullOrWhiteSpace(product?.Description))
 {
    <div class="card shadow-sm mb-5 border-0">
 <div class="card-body">
          <h4 class="card-title mb-3">Mô tả sản phẩm</h4>
 <div class="description-content text-muted lh-lg">
      @Html.Raw(product.Description)
       </div>
            </div>
</div>
    }

    <!-- VARIANTS SPECIFICATIONS TABLE -->
    <div class="card shadow-sm mb-5 border-0">
        <div class="card-body">
            <h4 class="card-title mb-4">Thông số các biến thể <span class="badge bg-secondary">@details.Count()</span></h4>
  
     @if (details.Any())
     {
                <div class="table-responsive">
        <table class="table table-hover align-middle">
       <thead class="table-light">
         <tr>
         <th style="width: 5%;">STT</th>
         <th style="width: 15%;">Chiều dài</th>
              <th style="width: 15%;">Độ cứng</th>
         <th style="width: 12%;">Màu sắc</th>
<th style="width: 13%;" class="text-danger">Giá</th>
       <th style="width: 15%;">Tồn kho</th>
         <th style="width: 10%; text-align: center;">Chi tiết</th>
          </tr>
            </thead>
     <tbody>
   @{ var index = 1; }
       @foreach (var detail in details)
           {
       <tr class="variant-row" data-detail-id="@detail.Id">
         <td class="fw-bold">@index</td>
          <td>@(detail.Length?.Name ?? "N/A")</td>
    <td>@(detail.Hardness?.Name ?? "N/A")</td>
    <td>@(detail.Color?.Name ?? "N/A")</td>
       <td class="text-danger fw-bold">@detail.Price.ToString("#,##0")₫</td>
  <td>
         @if (detail.StockQuantity > 0)
  {
          <span class="badge bg-success">Còn @detail.StockQuantity</span>
   }
        else
  {
         <span class="badge bg-danger">Hết hàng</span>
       }
      </td>
         <td class="text-center">
     <button type="button" class="btn btn-sm btn-outline-primary" 
data-bs-toggle="modal" 
 data-bs-target="#detailModal-@detail.Id">
            <i class="bi bi-info-circle"></i>
         </button>
           </td>
   </tr>
      index++;
         }
    </tbody>
           </table>
                </div>

            <!-- Detail Modals -->
    @foreach (var detail in details)
        {
   <div class="modal fade" id="detailModal-@detail.Id" tabindex="-1" aria-hidden="true">
         <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header border-bottom">
     <h5 class="modal-title">
           <strong>@(detail.Length?.Name)</strong> · @(detail.Hardness?.Name) · @(detail.Color?.Name)
  </h5>
  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
     <div class="modal-body">
     <div class="row g-4 mb-4">
        <div class="col-md-6">
      <h6 class="fw-bold text-primary mb-3">Thông tin cơ bản</h6>
    <table class="table table-sm table-borderless">
        <tr><td class="text-muted">Chiều dài</td><td class="fw-semibold">@(detail.Length?.Name ?? "-")</td></tr>
<tr><td class="text-muted">Độ cứng</td><td class="fw-semibold">@(detail.Hardness?.Name ?? "-")</td></tr>
   <tr><td class="text-muted">Màu sắc</td><td class="fw-semibold">@(detail.Color?.Name ?? "-")</td></tr>
   <tr><td class="text-muted">Độ đàn hồi</td><td class="fw-semibold">@(detail.Elasticity?.Name ?? "-")</td></tr>
        <tr><td class="text-muted">Bề mặt</td><td class="fw-semibold">@(detail.SurfaceFinish?.Name ?? "-")</td></tr>
        <tr><td class="text-muted">Xuất xứ</td><td class="fw-semibold">@(detail.OriginCountry?.Name ?? "-")</td></tr>
             <tr><td class="text-muted">Giá</td><td class="text-danger fw-bold">@detail.Price.ToString("#,##0")₫</td></tr>
         <tr><td class="text-muted">Tồn kho</td><td class="fw-semibold">@detail.StockQuantity</td></tr>
    <tr><td class="text-muted">Đã bán</td><td class="fw-semibold">@detail.SoldQuantity</td></tr>
  </table>
       </div>
       <div class="col-md-6">
   <h6 class="fw-bold text-primary mb-3">Thông số kỹ thuật</h6>
          <table class="table table-sm table-borderless">
          <tr><td class="text-muted">Số lóng</td><td class="fw-semibold">@(detail.Sections ?? "-")</td></tr>
                 <tr><td class="text-muted">Chiều dài gập</td><td class="fw-semibold">@(detail.CollapsedLength ?? "-")</td></tr>
   <tr><td class="text-muted">Trọng lượng</td><td class="fw-semibold">@(detail.Weight ?? "-")</td></tr>
        <tr><td class="text-muted">TL đầu</td><td class="fw-semibold">@(detail.TipWeight ?? "-")</td></tr>
             <tr><td class="text-muted">TL cán</td><td class="fw-semibold">@(detail.ButtWeight ?? "-")</td></tr>
   <tr><td class="text-muted">ĐK ngọn</td><td class="fw-semibold">@(detail.TipDiameter ?? "-")</td></tr>
   <tr><td class="text-muted">ĐK đầu</td><td class="fw-semibold">@(detail.TopDiameter ?? "-")</td></tr>
            <tr><td class="text-muted">ĐK cán</td><td class="fw-semibold">@(detail.ButtDiameter ?? "-")</td></tr>
  <tr><td class="text-muted">Điểm cân bằng</td><td class="fw-semibold">@(detail.BalancePoint ?? "-")</td></tr>
          </table>
     </div>
   </div>
   
@if (!string.IsNullOrWhiteSpace(detail.RecommendedLine) || 
             !string.IsNullOrWhiteSpace(detail.RecommendedFishWeight) || 
          !string.IsNullOrWhiteSpace(detail.HandleType) || 
        !string.IsNullOrWhiteSpace(detail.JointType) || 
          !string.IsNullOrWhiteSpace(detail.Warranty))
      {
     <div class="border-top pt-3">
       <h6 class="fw-bold text-primary mb-3">Thông tin bổ sung</h6>
          <table class="table table-sm table-borderless">
             @if (!string.IsNullOrWhiteSpace(detail.RecommendedLine))
           {
    <tr><td class="text-muted">Dây câu đề xuất</td><td class="fw-semibold">@detail.RecommendedLine</td></tr>
            }
    @if (!string.IsNullOrWhiteSpace(detail.RecommendedFishWeight))
    {
 <tr><td class="text-muted">Cá đề xuất</td><td class="fw-semibold">@detail.RecommendedFishWeight</td></tr>
       }
                @if (!string.IsNullOrWhiteSpace(detail.HandleType))
    {
    <tr><td class="text-muted">Loại tay cầm</td><td class="fw-semibold">@detail.HandleType</td></tr>
            }
       @if (!string.IsNullOrWhiteSpace(detail.JointType))
        {
<tr><td class="text-muted">Loại khớp nối</td><td class="fw-semibold">@detail.JointType</td></tr>
        }
      @if (!string.IsNullOrWhiteSpace(detail.Warranty))
     {
 <tr><td class="text-muted">Bảo hành</td><td class="fw-semibold">@detail.Warranty</td></tr>
                 }
       </table>
  </div>
        }

         @if (!string.IsNullOrWhiteSpace(detail.BalanceLoadDescription))
    {
        <div class="border-top pt-3">
   <h6 class="fw-bold text-primary mb-2">Mô tả tải</h6>
           <p class="text-muted mb-0">@detail.BalanceLoadDescription</p>
         </div>
        }

                <!-- Variant Images -->
              @if (detailImages.TryGetValue(detail.Id, out var variantImgs) && variantImgs.Any())
        {
 <div class="border-top pt-3 mt-3">
 <h6 class="fw-bold text-primary mb-3">Hình ảnh biến thể</h6>
        <div class="d-flex flex-wrap gap-2">
          @foreach (var imgUrl in variantImgs)
      {
           <img src="@imgUrl" alt="Ảnh biến thể" 
         class="img-thumbnail" 
      style="width: 100px; height: 100px; object-fit: cover; cursor: pointer;"
        onclick="openLightbox('@imgUrl')" />
        }
            </div>
    </div>
         }
 </div>
      <div class="modal-footer">
 <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
        </div>
      </div>
      </div>
         </div>
       }
            }
     else
     {
      <p class="text-muted text-center py-4">Chưa có biến thể nào cho sản phẩm này.</p>
     }
        </div>
    </div>

    <!-- GALLERY SECTION -->
    @if (!string.IsNullOrWhiteSpace(product?.Thumbnail) || allVariantImages.Any())
    {
        <div class="card shadow-sm border-0">
            <div class="card-body">
    <h4 class="card-title mb-4">Bộ sưu tập ảnh</h4>
                <div class="row g-3">
    @if (!string.IsNullOrWhiteSpace(product?.Thumbnail))
      {
   <div class="col-md-4 col-lg-3">
             <div class="card border-0 shadow-sm overflow-hidden cursor-pointer" onclick="openLightbox('@product.Thumbnail')" style="cursor: pointer;">
       <div class="ratio ratio-1x1">
               <img src="@product.Thumbnail" alt="Ảnh đại diện" class="img-fluid" style="object-fit: cover;">
  </div>
      <div class="card-body p-2 text-center">
          <small class="text-muted">Ảnh đại diện</small>
       </div>
  </div>
      </div>
    }

          @foreach (var detail in details)
        {
if (detailImages.TryGetValue(detail.Id, out var variantImgs) && variantImgs.Any())
  {
           var firstImg = variantImgs.FirstOrDefault();
               <div class="col-md-4 col-lg-3">
            <div class="card border-0 shadow-sm overflow-hidden" style="cursor: pointer;" onclick="openLightbox('@firstImg')">
       <div class="ratio ratio-1x1">
    <img src="@firstImg" alt="Ảnh" class="img-fluid" style="object-fit: cover;">
    </div>
        <div class="card-body p-2 text-center">
    <small class="text-muted d-block text-truncate">@detail.Length?.Name</small>
     <small class="text-muted d-block text-truncate">@detail.Hardness?.Name</small>
      </div>
  </div>
       </div>
         }
       }
     </div>
            </div>
        </div>
    }
</div>

<!-- Lightbox Modal -->
<div class="modal fade" id="lightboxModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-fullscreen modal-dialog-centered">
        <div class="modal-content bg-dark border-0">
      <div class="modal-header border-0">
         <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
     <div class="modal-body d-flex align-items-center justify-content-center p-0">
         <img id="lightboxImage" src="" alt="Ảnh phóng to" class="img-fluid" style="max-height: 90vh; object-fit: contain;">
  </div>
     </div>
    </div>
</div>

@section Scripts {
<script>
    const details = @Html.Raw(System.Text.Json.JsonSerializer.Serialize((details).Select(d => new {
        id = d.Id,
        price = d.Price,
        stock = d.StockQuantity,
     lengthId = d.LengthId,
        hardnessId = d.HardnessId
    })));

    const detailImagesMap = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(detailImages.ToDictionary(kv => kv.Key.ToString(), kv => kv.Value)));
    const productThumbnail = '@Html.Raw((product?.Thumbnail ?? "/images/product-placeholder.png").Replace("'", "\\'"))';

  function openLightbox(imageSrc) {
        document.getElementById('lightboxImage').src = imageSrc;
        var lightboxModal = new bootstrap.Modal(document.getElementById('lightboxModal'));
      lightboxModal.show();
    }

    function selectThumbnail(imgEl) {
        document.querySelectorAll('.thumbnail-img').forEach(t => {
            t.style.borderColor = '#e9ecef';
        t.classList.remove('active');
        });
   imgEl.style.borderColor = '#007bff';
        imgEl.classList.add('active');
        document.getElementById('main-product-image').src = imgEl.getAttribute('data-image-url');
    }

  function updateMainImageForVariant(detailId) {
        if (!detailId) {
         document.getElementById('main-product-image').src = productThumbnail;
document.querySelectorAll('.thumbnail-img').forEach(t => {
      t.style.borderColor = '#e9ecef';
      t.classList.remove('active');
            });
          const firstThumb = document.querySelector('.thumbnail-img[data-detail-id=""]');
            if (firstThumb) {
            firstThumb.style.borderColor = '#007bff';
      firstThumb.classList.add('active');
            }
          return;
        }
    const images = detailImagesMap[detailId];
        if (images && images.length > 0) {
   document.getElementById('main-product-image').src = images[0];
        document.querySelectorAll('.thumbnail-img').forEach(t => {
       t.style.borderColor = '#e9ecef';
                t.classList.remove('active');
            });
            const matchingThumb = document.querySelector('.thumbnail-img[data-detail-id="' + detailId + '"]');
   if (matchingThumb) {
              matchingThumb.style.borderColor = '#007bff';
   matchingThumb.classList.add('active');
   }
        }
    }

  let selectedHardnessId = null;
  let selectedLengthId = null;

    const hardnessButtons = document.querySelectorAll('.hardness-btn');
  const lengthButtons = document.querySelectorAll('.length-btn');
    const summaryEl = document.getElementById('selection-summary');

    function setActive(btns, idAttr, id) {
btns.forEach(b => {
      const isActive = id && b.getAttribute(idAttr) === id;
 b.classList.toggle('btn-primary', isActive);
       b.classList.toggle('btn-outline-primary', !isActive);
        });
    }

    function updateAvailability() {
        let validDetails = details.filter(d => d.stock > 0);
        if (selectedHardnessId) {
            validDetails = validDetails.filter(d => d.hardnessId === selectedHardnessId);
        }
     if (selectedLengthId) {
     validDetails = validDetails.filter(d => d.lengthId === selectedLengthId);
        }

        const validHardnessIds = new Set(validDetails.map(d => d.hardnessId));
        const validLengthIds = new Set(validDetails.map(d => d.lengthId));

 hardnessButtons.forEach(b => {
          const id = b.getAttribute('data-hardness-id');
       const hasStock = details.some(d => d.hardnessId === id && d.stock > 0);
            b.disabled = !hasStock || (selectedLengthId && !validHardnessIds.has(id));
        });

      lengthButtons.forEach(b => {
    const id = b.getAttribute('data-length-id');
    const hasStock = details.some(d => d.lengthId === id && d.stock > 0);
      b.disabled = !hasStock || (selectedHardnessId && !validLengthIds.has(id));
        });

        if (validDetails.length > 0) {
      const prices = validDetails.map(d => Number(d.price));
            const min = Math.min(...prices);
   const max = Math.max(...prices);
    const totalStock = validDetails.reduce((s,d)=> s + Number(d.stock), 0);
            summaryEl.innerHTML = `<strong>Giá:</strong> ${min.toLocaleString()}₫${min !== max ? ' – ' + max.toLocaleString() + '₫' : ''} | <strong>Còn:</strong> ${totalStock} hàng`;
     summaryEl.classList.remove('alert-danger');
 summaryEl.classList.add('alert-info');
      
            if (validDetails.length === 1) {
       updateMainImageForVariant(validDetails[0].id);
            } else {
     updateMainImageForVariant(null);
            }
        } else {
      summaryEl.innerHTML = '<strong>⚠ Không có sản phẩm phù hợp với lựa chọn của bạn</strong>';
 summaryEl.classList.remove('alert-info');
            summaryEl.classList.add('alert-danger');
            updateMainImageForVariant(null);
        }
    }

    hardnessButtons.forEach(b => {
        b.addEventListener('click', () => {
            const id = b.getAttribute('data-hardness-id');
            selectedHardnessId = (selectedHardnessId === id) ? null : id;
    setActive(hardnessButtons, 'data-hardness-id', selectedHardnessId);
 updateAvailability();
        });
    });
    
    lengthButtons.forEach(b => {
    b.addEventListener('click', () => {
     const id = b.getAttribute('data-length-id');
            selectedLengthId = (selectedLengthId === id) ? null : id;
            setActive(lengthButtons, 'data-length-id', selectedLengthId);
       updateAvailability();
        });
    });

    document.getElementById('qty-minus').addEventListener('click', () => {
        const qty = document.getElementById('qty');
        qty.value = Math.max(1, parseInt(qty.value || '1') - 1);
    });

    document.getElementById('qty-plus').addEventListener('click', () => {
        const qty = document.getElementById('qty');
        qty.value = Math.max(1, parseInt(qty.value || '1') + 1);
    });

    updateAvailability();

    function findSelectedDetail() {
        if (!selectedHardnessId || !selectedLengthId) return null;
  return details.find(d => d.hardnessId === selectedHardnessId && d.lengthId === selectedLengthId && d.stock > 0) || null;
    }

    document.getElementById('add-to-cart').addEventListener('click', async () => {
  const selected = findSelectedDetail();
        if (!selected) { 
            alert('Vui lòng chọn độ dài và độ cứng có hàng.');
         return;
        }
        const qty = Math.max(1, parseInt(document.getElementById('qty').value || '1'));
        const data = new URLSearchParams();
    data.append('productDetailId', selected.id);
        data.append('quantity', qty);
        try {
          const res = await fetch('/Cart/Add', {
method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
      body: data.toString(),
           credentials: 'same-origin'
    });
    if (res.ok) {
        location.reload();
            } else {
   alert('Không thể thêm vào giỏ hàng. Vui lòng thử lại.');
            }
        } catch (e) {
            alert('Có lỗi xảy ra khi thêm vào giỏ hàng.');
        }
    });
</script>
}
